import{r as a,j as e,x as ae,y as se,z as le,A as ne,F as re,i as E,b as _,s as Z,a as k,u as oe,I as ce,t as P}from"./index-eclOOh3M.js";import{E as H,D as $,S as ie,d as de,a as ue,C as me,b as xe,m as he,P as fe,p as pe,t as ge,c as je,e as be,f as Se,g as Ce,h as Ne}from"./Icons-e4OENU1T.js";import{t as we}from"./chunk-ORPGD37S-CLieFCnt.js";import{g as ve,d as _e,u as ye,c as Pe}from"./sedes-CkOp3GnC.js";import{u as G}from"./chunk-R6AK6OQ4-DQ7-aWAR.js";const Ie=({isOpen:s,onClose:c,sede:l,addSede:h,updateSede:S})=>{const[j,u]=a.useState(!1),f=b=>{u(!0),b.preventDefault();const g=Object.fromEntries(new FormData(b.currentTarget)),n=g.imageUrl,r=g.phone,i=g.direction,o=parseInt(g.rent);if(!n||!r||!i||!o){u(!1),k.error("Debe introducir todos los datos del formulario.");return}l!=null&&l.id||h(n,i,r,o).then().finally(()=>{u(!1)}),l!=null&&l.id&&S(l.id,n,i,r,o).then().finally(()=>{u(!1)}),u(!1),c()};return e.jsx(e.Fragment,{children:e.jsx(ae,{backdrop:"opaque",isOpen:s,onClose:c,size:"lg",children:e.jsx(se,{children:b=>e.jsxs(e.Fragment,{children:[e.jsxs(le,{className:"flex items-end  space-x-2 gap-1 font-[sans-serif] ",children:[e.jsx("img",{src:"./logo.webp",alt:"Logo reycel",className:"w-10 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Agregar Sede"})]}),e.jsx(ne,{children:e.jsxs(re,{onSubmit:f,children:[e.jsxs("div",{className:"flex flex-col gap-4 min-w-full items-center",children:[e.jsx("img",{className:"w-4/5 h-52 bg-neutral-300 rounded-lg",src:"./logo.webp",alt:"imagen de telefono"}),e.jsx(E,{label:"Introduce la url de la Imagen",labelPlacement:"outside",defaultValue:l==null?void 0:l.image,name:"imageUrl",placeholder:"url/imagen.com",startContent:e.jsx("div",{className:"pointer-events-none flex items-center",children:e.jsx("span",{className:"text-default-400 text-small",children:"https://"})}),type:"url"})]}),e.jsxs("div",{className:"flex gap-2 min-w-full",children:[e.jsx(E,{name:"phone",autoFocus:!0,defaultValue:l==null?void 0:l.phone,startContent:e.jsx("span",{className:"text-sm text-default-800 pointer-events-none flex-shrink-0",children:"+53"}),endContent:e.jsx("svg",{className:"w-6 h-6 text-gray-500 dark:text-white","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{fillRule:"evenodd",d:"M5 4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4Zm12 12V5H7v11h10Zm-5 1a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H12Z",clipRule:"evenodd"})}),label:"Telefono",placeholder:"XXXXXXXX",variant:"bordered",labelPlacement:"outside"}),e.jsx(E,{name:"rent",autoFocus:!0,defaultValue:l==null?void 0:l.rent.toString(),startContent:e.jsx("span",{className:"text-sm text-default-800 pointer-events-none flex-shrink-0",children:"$"}),label:"Renta del Local",placeholder:"Ingrese el monto de la renta",variant:"bordered",labelPlacement:"outside"})]}),e.jsx(we,{label:"Direccion:",name:"direction",defaultValue:l==null?void 0:l.direction,isRequired:!0,labelPlacement:"outside",placeholder:"Introduce la direccion de la sede."}),e.jsxs("div",{className:"flex min-w-full justify-end mt-5 gap-3",children:[e.jsx(_,{color:"danger",variant:"light",onPress:b,children:"Cancelar"}),e.jsxs(_,{color:"primary",type:"submit",children:[j&&e.jsx(Z,{color:"danger"}),!j&&e.jsx("span",{children:"Guardar"})]})]})]})})]})})})})};function Ee(){const[s,c]=a.useState([]),[l,h]=a.useState(null),[S,j]=a.useState(!1),u=a.useCallback(()=>{j(!0),ve().then(n=>{c(n.data.data)}).catch(n=>{h(n)}).finally(()=>{j(!1)})},[]);return{sedes:s,setSedes:c,setError:h,error:l,loading:S,getSedes:u,addSede:async(n,r,i,o)=>{Pe({image:n,direction:r,phone:i,rent:o}).then(m=>{if(!s){c(m.data.data);return}c([...s,m.data.data])}).catch(m=>{console.log(m),h(["Error al crear la sede."])})},updateSede:async(n,r,i,o,m)=>{ye(n,{image:r,direction:i,phone:o,rent:m}).then(p=>{const A=s==null?void 0:s.findIndex(C=>C.id===n);s==null||s.splice(A,1,p.data.sede),c([...s])}).catch(p=>{h(p)})},deleteSede:async n=>{_e(n).then(()=>{c(r=>r?r.filter(i=>i.id!==n):[])}).catch(r=>{h(r)})}}}function ke(s){return s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""}const R=[{name:"IMAGEN",uid:"image",sortable:!0},{name:"TELEFONO",uid:"phone",sortable:!0},{name:"RENTA",uid:"rent"},{name:"PERDIDAS O INVERSIONES",uid:"losses"},{name:"GANANCIA NETA SEMANAL",uid:"profits"},{name:"TRABAJADOR",uid:"worker",sortable:!0},{name:"ACTIONS",uid:"actions"}],Ae=["image","phone","rent","profits","losses","worker","actions"];function Fe(){const{sedes:s,loading:c,error:l,addSede:h,deleteSede:S,updateSede:j,getSedes:u}=Ee(),{user:f}=oe(),[b,g]=a.useState(void 0),{isOpen:n,onOpen:r,onClose:i}=ce(),[o,m]=a.useState(""),[p,A]=a.useState(new Set(Ae)),[C,J]=a.useState(10),[y,W]=a.useState({column:"name",direction:"ascending"}),[x,N]=a.useState(1),L=!!o,M=a.useCallback(t=>()=>{r(),g(t)},[r]),V=a.useCallback(()=>{g(void 0),r()},[r]);a.useEffect(()=>{u()},[u]);const K=a.useMemo(()=>p==="all"?R:R.filter(t=>Array.from(p).includes(t.uid)),[p]),D=a.useMemo(()=>{if(!s)return[];let t=[...s];return L&&(t=t.filter(d=>d.phone.toLowerCase().includes(o.toLowerCase())||d.direction.toLowerCase().includes(o.toLowerCase()))),t},[o,L,s]),w=Math.ceil(D.length/C),F=a.useMemo(()=>{const t=(x-1)*C,d=t+C;return D.slice(t,d)},[x,D,C]),Q=a.useMemo(()=>[...F].sort((t,d)=>{const I=t[y.column],v=d[y.column],B=I<v?-1:I>v?1:0;return y.direction==="descending"?-B:B}),[y,F]),O=a.useCallback(t=>()=>{S(t)},[S]),Y=a.useCallback((t,d)=>{const I=t[d];switch(d){case"image":return e.jsx(G,{avatarProps:{radius:"lg",src:t.image},name:t.direction,description:t.phone});case"rent":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("p",{className:"text-bold text-small capitalize",children:["$",t.rent]})});case"losses":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("p",{className:"text-bold text-small capitalize",children:["$",t.finalLosses]})});case"profits":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("p",{className:"text-bold text-small capitalize",children:["$",t.netProfits]})});case"worker":return e.jsx(P,{content:e.jsxs("div",{className:" flex flex-col items-start gap-2 p-4",children:[e.jsx("span",{className:"font-semibold pb-2",children:"Trabajadores "}),t.workers.map(v=>e.jsx(G,{avatarProps:{radius:"lg",src:v.baseUser.image},name:v.baseUser.username},v.id))]}),children:t.workers.length});case"actions":return(f==null?void 0:f.role)==="OWNER"?e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(P,{content:"Edit Sede",color:"success",children:e.jsx("button",{onClick:M(t),className:"text-lg text-success cursor-pointer active:opacity-50",children:e.jsx(H,{})})}),t._count.producto===0&&t.workers.length===0&&e.jsx(P,{color:"danger",content:"Delete Sede",children:e.jsx("button",{onClick:O(t.id),className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx($,{})})})]}):e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(P,{content:"Edit Sede",color:"success",children:e.jsx("button",{onClick:()=>k.error("Solo disponible para el administrador"),className:"text-lg text-success cursor-pointer active:opacity-50",children:e.jsx(H,{})})}),e.jsx(P,{color:"danger",content:"Delete Sede",children:e.jsx("button",{onClick:()=>k.error("Solo disponible para el administrador"),className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx($,{})})})]});default:return String(I)}},[O,M,f==null?void 0:f.role]),T=a.useCallback(()=>{x<w&&N(x+1)},[x,w]),z=a.useCallback(()=>{x>1&&N(x-1)},[x]),X=a.useCallback(t=>{J(Number(t.target.value)),N(1)},[]),q=a.useCallback(t=>{t?(m(t),N(1)):m("")},[]),U=a.useCallback(()=>{m(""),N(1)},[]),ee=a.useMemo(()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 items-end",children:[e.jsx(E,{isClearable:!0,className:"w-full sm:max-w-[44%]",placeholder:"Búsqueda por nombre...",startContent:e.jsx(ie,{}),value:o,onClear:()=>U(),onValueChange:q}),e.jsxs("div",{className:"flex gap-3 w-full justify-center sm:w-auto",children:[e.jsxs(de,{children:[e.jsx(ue,{children:e.jsx(_,{endContent:e.jsx(me,{className:"text-small"}),variant:"flat",children:"Columnas"})}),e.jsx(xe,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:p,selectionMode:"multiple",onSelectionChange:A,children:R.map(t=>e.jsx(he,{className:"capitalize",children:ke(t.name)},t.uid))})]}),e.jsx(_,{color:"success",endContent:e.jsx(fe,{}),onPress:V,children:"Nueva Sede"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-default-400 text-small",children:["Total ",s==null?void 0:s.length," sedes"]}),e.jsxs("label",{className:"flex items-center text-default-400 text-small",children:["Filas por páginas:",e.jsxs("select",{className:"bg-transparent outline-none text-default-400 text-small",onChange:X,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]})]})]}),[o,q,p,V,s==null?void 0:s.length,X,U]),te=a.useMemo(()=>e.jsxs("div",{className:"py-2 px-2 flex justify-between items-center",children:[e.jsx(pe,{isCompact:!0,showControls:!0,showShadow:!0,color:"success",page:x,total:w,onChange:N}),e.jsxs("div",{className:" justify-end gap-2",children:[e.jsx(_,{isDisabled:w===1,size:"md",variant:"flat",onPress:z,color:"danger",className:"mx-2",children:"Anterior"}),e.jsx(_,{isDisabled:w===1,size:"md",variant:"flat",onPress:T,color:"success",children:"Siguiente"})]})]}),[x,w,z,T]);return e.jsxs(e.Fragment,{children:[l&&k.error(l),e.jsxs(ge,{isHeaderSticky:!0,"aria-label":"Example table with custom cells, pagination and sorting",bottomContent:te,bottomContentPlacement:"outside",classNames:{wrapper:"max-h-[600px]"},sortDescriptor:y,topContent:ee,topContentPlacement:"outside",onSortChange:W,children:[e.jsx(je,{columns:K,children:t=>e.jsx(be,{align:t.uid==="actions"?"center":"start",allowsSorting:t.sortable,children:t.name},t.uid)}),e.jsx(Se,{isLoading:c,loadingContent:e.jsx(Z,{color:"success"}),emptyContent:"No users found",items:Q,children:t=>e.jsx(Ce,{children:d=>e.jsx(Ne,{children:Y(t,d)})},t.id)})]}),e.jsx(Ie,{isOpen:n,onClose:i,sede:b,addSede:h,updateSede:j})]})}export{ke as Capitalize,Fe as default};
