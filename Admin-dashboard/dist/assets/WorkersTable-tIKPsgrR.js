import{U as V,r as t,j as e,x as ne,y as oe,z as ie,A as ce,F as de,i as E,X as J,Y as ue,Z as Q,a0 as me,v as ee,w as ae,b as A,s as le,a as o,u as xe,I as fe,t as q}from"./index-BvSoqA-Z.js";import{E as se,D as te,S as he,d as pe,a as je,C as be,b as ge,m as Ce,P as Se,p as Ne,t as we,c as ye,e as ve,f as Ee,g as _e,h as Pe}from"./Icons-Dq4C29eR.js";import{g as ke}from"./sedes-Er68_6zp.js";import{c as Ae}from"./chunk-J7I6W5JF-CIxxxe5A.js";import{u as Re}from"./chunk-R6AK6OQ4-BfRhABQq.js";const Ie=()=>V.get("/worker"),Oe=s=>V.post("/worker",s),Me=(s,h)=>V.put(`/worker/${s}`,h),De=s=>V.delete(`/worker/${s}`),Te=[{key:"OWNER",label:"Admin"},{key:"MODERATOR",label:"Moderador"}],Le=({id:s,username:h,image:g,email:C,salary:S,isOpen:_,onClose:u,setWorkers:M})=>{const[j,i]=t.useState(!1),[N,R]=t.useState("./logo.webp"),[w,I]=t.useState(),[l,B]=t.useState([]),[c,p]=t.useState(!0);t.useEffect(()=>{w==="MODERATOR"?(p(!1),ke().then(d=>{B(d.data.data)})):p(!0)},[w]),t.useEffect(()=>(s&&R(g||"./logo.webp"),()=>{R("./logo.webp")}),[s,g]);const D=d=>{R(d.target.value)},$=d=>{I(d.target.value),console.log(d)},T=d=>{d.preventDefault(),i(!0);const r=Object.fromEntries(new FormData(d.currentTarget)),L=r.image,y=r.role,v=r.sede,m=r.user,P=r.password,U=r.passwordConfirm,O=r.email,k=Number(r.salary);if(!y){o.error("El rol del usuario es requerido."),i(!1);return}if(y==="MODERATOR"&&!v){o.error("Debe elegir una sede para el moderador."),i(!1);return}if(y==="MODERATOR"&&!k){o.error("Debe escribir el salario del moderador."),i(!1);return}if(!m){o.error("El nombre del usuario es requerido."),i(!1);return}if(!O){o.error("El email es requerido."),i(!1);return}if(!P&&!s){o.error("La contraseña es requerida."),i(!1);return}if((!U||U!==P)&&!s){o.error("Las contraseñas no coinciden."),i(!1);return}s&&Me(s,{image:L,password:P,role:y,sedeId:v,username:m,email:O,salary:k}).then(x=>{M(b=>{if(!b)return null;const F=x.data.data,z=b.filter(Y=>Y.id!==s);return[F,...z]}),o.success("Trabajador editado con exito")}).catch(x=>{console.log(x),o.error("Error al editar el trabajador")}).finally(()=>{i(!1),u(),I(null)}),s||Oe({image:L,email:O,password:P,role:y,sedeId:v,username:m,salary:k}).then(x=>{M(b=>b?[x.data.data,...b]:null),o.success("Trabajador creacto con exito")}).catch(x=>{console.log(x),o.error("Error al crear el trabajador")}).finally(()=>{i(!1),u(),I(null)})};return e.jsx(e.Fragment,{children:e.jsx(ne,{backdrop:"opaque",isOpen:_,onClose:u,size:"4xl",children:e.jsx(oe,{children:d=>e.jsxs(e.Fragment,{children:[e.jsxs(ie,{className:"flex items-end  space-x-2 gap-1 font-[sans-serif] ",children:[e.jsx("img",{src:"./logo.webp",alt:"Logo reycel",className:"w-10 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Agregar Usuario"})]}),e.jsx(ce,{children:e.jsxs(de,{onSubmit:T,children:[e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col items-center w-full gap-4",children:[e.jsx("img",{className:"size-56 bg-neutral-300",src:N,alt:"Imagen de Usuario"}),e.jsx(E,{autoFocus:!0,name:"image",defaultValue:g,onChange:D,endContent:e.jsx(J,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Url Imagen",placeholder:"https://image.example",variant:"bordered",labelPlacement:"outside"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx(E,{autoFocus:!0,name:"user",defaultValue:h,endContent:e.jsx(J,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Usuario",placeholder:"Entra el usuario",variant:"bordered",labelPlacement:"outside"}),e.jsx(E,{endContent:e.jsx(ue,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Email",defaultValue:C,name:"email",placeholder:"Entra su email",type:"email",variant:"bordered",labelPlacement:"outside"}),e.jsx(E,{endContent:e.jsx(Q,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Password",name:"password",placeholder:"Entra el password",type:"password",variant:"bordered",labelPlacement:"outside"}),e.jsx(E,{endContent:e.jsx(Q,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Confirmar Password",name:"passwordConfirm",placeholder:"Confirma el password",type:"password",variant:"bordered",labelPlacement:"outside"})]})]}),e.jsxs("div",{className:"w-full flex justify-between gap-4",children:[e.jsx(E,{endContent:e.jsx(me,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Salario Fijo",name:"salary",defaultValue:String(S),placeholder:"Salario Fijo",type:"text",variant:"bordered",isDisabled:c,labelPlacement:"outside"}),e.jsx(ee,{variant:"bordered",label:"Role",name:"role",defaultOpen:!0,placeholder:"Seleccione el role",labelPlacement:"outside",onChange:$,children:Te.map(r=>e.jsx(ae,{children:r.label},r.key))})]}),e.jsx(ee,{className:"w-full",variant:"bordered",label:"Sede",name:"sede",placeholder:"Seleccione la Sede",labelPlacement:"outside",isDisabled:c,defaultSelectedKeys:l.flatMap(r=>r.id),children:l.map(r=>e.jsx(ae,{children:r.direction},r.id))}),e.jsxs("div",{className:"flex min-w-full justify-end mt-5 gap-3",children:[e.jsx(A,{color:"danger",variant:"light",onPress:d,children:"Cancelar"}),e.jsxs(A,{color:"primary",type:"submit",children:[j&&e.jsx(le,{color:"default"}),!j&&e.jsx("span",{className:" font-semibold",children:"Guardar"})]})]})]})})]})})})})};function Ue(){const[s,h]=t.useState(null),[g,C]=t.useState(null),[S,_]=t.useState(!1);return t.useEffect(()=>{C(null),_(!0),Ie().then(u=>{h(u.data)}).catch(u=>{console.log(u),C(["Error al cargar los trabajadores"])}).finally(()=>{_(!1)})},[]),{workers:s,error:g,loading:S,setWorkers:h}}function Fe(s){return s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""}const K=[{name:"NOMBRE",uid:"username",sortable:!0},{name:"SALARIO BASICO",uid:"salary"},{name:"SALARIO DEL MES",uid:"mouthSalary"},{name:"CREADO EL ",uid:"createdAt",sortable:!0},{name:"STATUS",uid:"status",sortable:!0},{name:"# ORDENES",uid:"order"},{name:"ACCIONES",uid:"actions"}],ze={true:"success",false:"danger"},We=["username","status","actions","mouthSalary","order","salary"];function Ge(){const{workers:s,error:h,loading:g,setWorkers:C}=Ue(),{user:S}=xe(),{isOpen:_,onOpen:u,onClose:M}=fe(),[j,i]=t.useState(""),[N,R]=t.useState(new Set(We)),[w,I]=t.useState(10),[l,B]=t.useState(),[c,p]=t.useState(1),D=!!j,[$,T]=t.useState(null),d=()=>{T(null),u()},r=a=>{T(a),u()},L=a=>{const n=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],f=new Date(a),G=f.getUTCDate(),H=n[f.getUTCMonth()],W=f.getUTCFullYear();return`${G} ${H} ${W}`},y=t.useMemo(()=>N==="all"?K:K.filter(a=>Array.from(N).includes(a.uid)),[N]),v=t.useMemo(()=>{if(!s)return[];let a=[...s];return D&&(a=a.filter(n=>n.username.toLowerCase().includes(j.toLowerCase()))),a},[s,D,j]),m=Math.ceil(v.length/w),P=t.useMemo(()=>{const a=[...v].sort((G,H)=>{const W=G[l==null?void 0:l.column],X=H[l==null?void 0:l.column],Z=W<X?-1:W>X?1:0;return(l==null?void 0:l.direction)==="descending"?-Z:Z}),n=(c-1)*w,f=n+w;return a.slice(n,f)},[v,c,w,l==null?void 0:l.column,l==null?void 0:l.direction]),U=a=>{De(a).then(()=>{o.success("Trabajador eliminado con exito"),C(n=>n?n.filter(f=>f.id!==a):null)}).catch(n=>{console.log(n),o.error("Error al eliminar el trabajador")})},O=t.useCallback((a,n)=>{const f=a[n];switch(n){case"username":return e.jsx(Re,{avatarProps:{radius:"lg",src:a.image},name:e.jsx("span",{style:{display:"inline-block",maxWidth:"250px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.username}),description:a.email});case"salary":return e.jsxs("div",{className:"flex justify-left",children:[e.jsx("span",{children:"$"}),e.jsx("p",{className:"text-bold text-small capitalize",children:a.salary})]});case"mouthSalary":return e.jsxs("div",{className:"flex justify-left",children:[e.jsx("span",{children:"$"}),e.jsx("p",{className:"text-bold text-small capitalize",children:a.mouthSalary})]});case"createdAt":return e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"text-bold text-small capitalize",children:L(a.createdAt)})});case"order":return e.jsx("div",{className:"flex justify-center",children:e.jsx("p",{className:"text-bold text-small capitalize",children:a.orderCount})});case"status":return e.jsx("div",{className:"w-full flex justify-center",children:e.jsx(Ae,{className:"capitalize",color:ze[String(a.status)],size:"sm",variant:"flat",children:String(f)})});case"actions":return(S==null?void 0:S.role)==="OWNER"?e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(q,{content:"Edit worker",color:"success",children:e.jsx("button",{onClick:()=>r(a),className:"text-lg text-success cursor-pointer active:opacity-50",children:e.jsx(se,{})})}),e.jsx(q,{color:"danger",content:"Delete worker",children:e.jsx("button",{onClick:()=>{U(a.id)},className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx(te,{})})})]}):e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(q,{content:"Edit worker",color:"success",children:e.jsx("button",{onClick:()=>o.error("Solo disponible para el Administrador"),className:"text-lg text-success cursor-pointer active:opacity-50",disabled:!0,children:e.jsx(se,{})})}),e.jsx(q,{color:"danger",content:"Delete worker",children:e.jsx("button",{disabled:!0,onClick:()=>{o.error("Solo disponible para el Administrador")},className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx(te,{})})})]});default:return String(f)}},[]),k=t.useCallback(()=>{c<m&&p(c+1)},[c,m]),x=t.useCallback(()=>{c>1&&p(c-1)},[c]),b=t.useCallback(a=>{console.log(a.target.value),I(Number(a.target.value)),p(1)},[]),F=t.useCallback(a=>{a?(i(a),p(1)):i("")},[]),z=t.useCallback(()=>{i(""),p(1)},[]),Y=t.useMemo(()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 items-end ",children:[e.jsx(E,{isClearable:!0,color:"primary",className:"w-full sm:max-w-[44%]",placeholder:"Búsqueda...",startContent:e.jsx(he,{}),value:j,onClear:()=>z(),onValueChange:F}),e.jsxs("div",{className:"flex gap-3 w-full justify-center sm:w-auto ",children:[e.jsxs(pe,{children:[e.jsx(je,{className:"",children:e.jsx(A,{endContent:e.jsx(be,{className:"text-small"}),variant:"flat",children:"Columnas"})}),e.jsx(ge,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:N,selectionMode:"multiple",onSelectionChange:R,children:K.map(a=>e.jsx(Ce,{className:"capitalize",children:Fe(a.name)},a.uid))})]}),e.jsx(A,{color:"primary",endContent:e.jsx(Se,{}),onPress:d,children:"Nuevo Trabajador"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-default-400 text-small",children:["Total ",s==null?void 0:s.length," usuarios"]}),e.jsxs("label",{className:"flex items-center text-default-400 text-small",children:["Filas por páginas:",e.jsxs("select",{className:"bg-transparent outline-none text-default-400 text-small",onChange:b,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]})]})]}),[j,F,N,u,s==null?void 0:s.length,b,z]),re=t.useMemo(()=>e.jsxs("div",{className:"py-2 px-2 flex justify-between items-center",children:[e.jsx(Ne,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:c,total:m,onChange:p}),e.jsxs("div",{className:"justify-end gap-2",children:[e.jsx(A,{isDisabled:m===1,size:"md",variant:"flat",onPress:x,color:"danger",className:"mx-2",children:"Anterior"}),e.jsx(A,{isDisabled:m===1,size:"md",variant:"flat",onPress:k,color:"success",children:"Siguiente"})]})]}),[c,m,x,k]);return e.jsxs(e.Fragment,{children:[h&&h.map(a=>o.error(a)),e.jsxs(we,{isHeaderSticky:!0,"aria-label":"Example table with custom cells, pagination and sorting",bottomContent:re,bottomContentPlacement:"outside",classNames:{wrapper:"max-h-[670px]"},color:"danger",sortDescriptor:l,topContent:Y,topContentPlacement:"outside",onSortChange:B,children:[e.jsx(ye,{columns:y,children:a=>e.jsx(ve,{align:a.uid==="actions"||a.uid==="createdAt"||a.uid==="order"||a.uid==="status"?"center":"start",allowsSorting:a.sortable,children:a.name},a.uid)}),e.jsx(Ee,{isLoading:g,loadingContent:e.jsx(le,{color:"white"}),emptyContent:"No users found",items:P,children:a=>e.jsx(_e,{children:n=>e.jsx(Pe,{children:O(a,n)})},a.id)})]}),e.jsx(Le,{isOpen:_,onClose:M,setWorkers:C,...$})]})}export{Fe as Capitalize,Ge as default};
