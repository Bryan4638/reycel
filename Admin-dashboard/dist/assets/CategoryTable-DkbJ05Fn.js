import{r as l,j as e,x as Z,y as ee,z as te,A as ae,F as se,i as R,L as le,M as ne,b as g,s as re,N as oe,a as m,O as ce,P as ie,I as de,u as ue,t as S,Q as me}from"./index-eclOOh3M.js";import{E as q,D as B,S as xe,d as fe,a as he,C as pe,b as ge,m as je,P as be,p as Ce,t as Ne,c as ye,e as _e,f as ve,g as we,h as Se}from"./Icons-e4OENU1T.js";import{u as Ae}from"./useCategory-ClAsN5DJ.js";const Pe=({id:s,name:C,profitsBySell:f,isOpen:A,onClose:x,setCategory:N})=>{const[h,c]=l.useState(!1),j=o=>{o.preventDefault(),c(!0);const y=Object.fromEntries(new FormData(o.currentTarget)),d=y.name,_=parseInt(y.profits);if(!d){m.error("Debe poner un nombre a la categoría"),c(!1);return}s&&ce(s,d,_).then(a=>{const b=a.data.data;N(n=>{if(!n)return null;const u=n.filter(v=>v.id!==s);return[b,...u]})}).catch(a=>{console.log(a),m.error("Error al actualizar la categoría")}).finally(()=>{c(!1),x()}),s||ie(d,_).then(a=>{const b=a.data.data;N(n=>n?[b,...n]:null)}).catch(a=>{console.log(a),m.error("Error al crear la categoría")}).finally(()=>{c(!1),x()})};return e.jsx(e.Fragment,{children:e.jsx(Z,{backdrop:"opaque",isOpen:A,onClose:x,size:"lg",children:e.jsx(ee,{children:o=>e.jsxs(e.Fragment,{children:[e.jsxs(te,{className:"flex items-end  space-x-2 gap-1 font-[sans-serif] ",children:[e.jsx("img",{src:"./logo.webp",alt:"Logo reycel",className:"w-10 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Agregar Categoría"})]}),e.jsx(ae,{children:e.jsxs(se,{onSubmit:j,children:[e.jsx(R,{autoFocus:!0,name:"name",defaultValue:C,endContent:e.jsx(le,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Nombre",placeholder:"Inserte el Nombre de la categroría",variant:"bordered",labelPlacement:"outside"}),e.jsx(R,{name:"profits",defaultValue:f==null?void 0:f.toString(),endContent:e.jsx(ne,{className:"text-2xl text-default-400 pointer-events-none flex-shrink-0"}),label:"Ganancias del Moderador por Venta",placeholder:"Inserte la ganancia",variant:"bordered",labelPlacement:"outside"}),e.jsxs("div",{className:"flex min-w-full justify-end mt-5 gap-3",children:[e.jsx(g,{color:"danger",variant:"light",onPress:o,children:"Cancelar"}),e.jsxs(g,{color:"primary",type:"submit",onPress:o,children:[h&&e.jsx(re,{color:"default"}),!h&&e.jsx("span",{className:"font-medium",children:"Guardar"})]})]})]})}),e.jsx(oe,{})]})})})})};function Ee(s){return s?s.charAt(0).toUpperCase()+s.slice(1).toLowerCase():""}const O=[{name:"NOMBRE",uid:"name",sortable:!0},{name:"CANTIDAD DE PRODUCTOS",uid:"productquantity",sortable:!0},{name:"GANACIA POR PRODUCTO",uid:"profitsBySell",sortable:!0},{name:"FECHA DE CREACION",uid:"createdAt",sortable:!0},{name:"GANANCIA POR VENTA DEL MODERADOR",uid:"profits"},{name:"ACTIONS",uid:"actions"}],Ie=["name","productquantity","profitsBySell","createdAt","actions"];function Me(){const{category:s,error:C,setCategory:f}=Ae(),{isOpen:A,onOpen:x,onClose:N}=de(),{user:h}=ue(),[c,j]=l.useState(""),[o,y]=l.useState(new Set(Ie)),[d,_]=l.useState(15),[a,b]=l.useState(),[n,u]=l.useState(1),v=!!c,[U,D]=l.useState(null),G=()=>{D(null),x()},$=t=>{D(t),x()},H=l.useMemo(()=>o==="all"?O:O.filter(t=>Array.from(o).includes(t.uid)),[o]),P=l.useMemo(()=>{if(!s)return[];let t=[...s];return v&&(t=t.filter(r=>r.name.toLowerCase().includes(c.toLowerCase()))),t},[s,c,v]),p=Math.ceil(P.length/d),Q=l.useMemo(()=>{const t=[...P].sort((E,I)=>{const w=E[a==null?void 0:a.column],L=I[a==null?void 0:a.column],V=w<L?-1:w>L?1:0;return(a==null?void 0:a.direction)==="descending"?-V:V}),r=(n-1)*d,i=r+d;return t.slice(r,i)},[P,n,d,a==null?void 0:a.column,a==null?void 0:a.direction]),W=t=>{const r=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],i=new Date(t),E=i.getUTCDate(),I=r[i.getUTCMonth()],w=i.getUTCFullYear();return`${E} ${I} ${w}`},Y=t=>{me(t).then(()=>{m.success("Categoría eliminado con exito"),f(r=>r?r.filter(i=>i.id!==t):null)}).catch(r=>{console.log(r),m.error("Error al eliminar el producto")})},J=l.useCallback((t,r)=>{const i=t[r];switch(r){case"name":return e.jsx("div",{className:"flex flex-col",children:e.jsx("p",{className:"text-bold text-small capitalize",children:t.name})});case"productquantity":return e.jsx("div",{className:"flex ",children:e.jsx("p",{className:"text-bold text-small capitalize",children:t._count.products})});case"profitsBySell":return e.jsx("div",{className:"flex ",children:e.jsx("p",{className:"text-bold text-small capitalize",children:t.profitsBySell})});case"profits":return e.jsx("div",{className:"flex ",children:e.jsx("p",{className:"text-bold text-small capitalize",children:t.profitsBySell})});case"createdAt":return e.jsx("div",{className:"flex ",children:e.jsx("p",{className:"text-bold text-small capitalize",children:W(t.createdAt)})});case"actions":return(h==null?void 0:h.role)==="OWNER"?e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(S,{content:"Edit Category",color:"success",children:e.jsx("button",{onClick:()=>$(t),className:"text-lg text-success cursor-pointer active:opacity-50",children:e.jsx(q,{})})}),t._count.products===0&&e.jsx(S,{color:"danger",content:"Delete Category",children:e.jsx("button",{onClick:()=>{Y(t.id)},className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx(B,{})})})]}):e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(S,{content:"Edit Category",color:"success",children:e.jsx("button",{onClick:()=>m.error("Solo disponible para el Administrador"),className:"text-lg text-success cursor-pointer active:opacity-50",children:e.jsx(q,{})})}),e.jsx(S,{color:"danger",content:"Delete Category",children:e.jsx("button",{onClick:()=>{m.error("Solo disponible para el Administrador")},className:"text-lg text-danger cursor-pointer active:opacity-50",children:e.jsx(B,{})})})]});default:return String(i)}},[]),M=l.useCallback(()=>{n<p&&u(n+1)},[n,p]),k=l.useCallback(()=>{n>1&&u(n-1)},[n]),F=l.useCallback(t=>{_(Number(t.target.value)),u(1)},[]),z=l.useCallback(t=>{t?(j(t),u(1)):j("")},[]),T=l.useCallback(()=>{j(""),u(1)},[]),K=l.useMemo(()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3 items-end ",children:[e.jsx(R,{isClearable:!0,color:"success",className:"w-full sm:max-w-[44%]",placeholder:"Búsqueda ...",startContent:e.jsx(xe,{}),value:c,onClear:()=>T(),onValueChange:z}),e.jsxs("div",{className:"flex gap-3 w-full justify-center sm:w-auto ",children:[e.jsxs(fe,{children:[e.jsx(he,{children:e.jsx(g,{endContent:e.jsx(pe,{className:"text-small"}),variant:"flat",children:"Columnas"})}),e.jsx(ge,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:o,selectionMode:"multiple",onSelectionChange:y,children:O.map(t=>e.jsx(je,{className:"capitalize",children:Ee(t.name)},t.uid))})]}),e.jsx(g,{color:"success",endContent:e.jsx(be,{}),onPress:G,children:"Nueva Categoria"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-default-400 text-small",children:["Total ",s==null?void 0:s.length," Categorias"]}),e.jsxs("label",{className:"flex items-center text-default-400 text-small",children:["Filas por páginas:",e.jsxs("select",{className:"bg-transparent outline-none text-default-400 text-small",onChange:F,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]})]})]}),[c,z,o,x,s==null?void 0:s.length,F,T]),X=l.useMemo(()=>e.jsxs("div",{className:"py-2 px-2 flex justify-between items-center",children:[e.jsx(Ce,{isCompact:!0,showControls:!0,showShadow:!0,color:"success",page:n,total:p,onChange:u}),e.jsxs("div",{className:" justify-end gap-2",children:[e.jsx(g,{isDisabled:p===1,size:"md",variant:"flat",onPress:k,color:"danger",className:"mx-2",children:"Anterior"}),e.jsx(g,{isDisabled:p===1,size:"md",variant:"flat",onPress:M,color:"success",children:"Siguiente"})]})]}),[n,p,k,M]);return e.jsxs(e.Fragment,{children:[C&&C.map(t=>m.error(t)),e.jsxs(Ne,{isHeaderSticky:!0,"aria-label":"Example table with custom cells, pagination and sorting",bottomContent:X,bottomContentPlacement:"outside",classNames:{wrapper:"max-h-[615px]"},sortDescriptor:a,topContent:K,topContentPlacement:"outside",onSortChange:b,children:[e.jsx(ye,{columns:H,children:t=>e.jsx(_e,{align:t.uid==="actions"?"center":"start",allowsSorting:t.sortable,children:t.name},t.uid)}),e.jsx(ve,{isLoading:!0,emptyContent:"No categories found",items:Q,children:t=>e.jsx(we,{children:r=>e.jsx(Se,{children:J(t,r)})},t.id)})]}),e.jsx(Pe,{isOpen:A,onClose:N,setCategory:f,...U})]})}export{Ee as Capitalize,Me as default};
