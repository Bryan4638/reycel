import{U as A,r as t,j as e,x as J,y as K,z as Q,A as W,F as X,v as Y,w as Z,i as q,b as C,s as O,a as T,I as ee}from"./index-CoKN0y7C.js";import{S as se,d as te,a as ae,C as ne,b as le,m as re,P as oe,p as ie,t as ce,c as de,e as ue,f as me,g as xe,h as fe}from"./Icons-Ir8WEg-7.js";import{g as pe}from"./sedes-CG4m7rHf.js";import{t as he}from"./chunk-ORPGD37S-mjngWJxm.js";import{u as ge}from"./chunk-R6AK6OQ4-D6HQW98L.js";const je=()=>A.get("/losses"),be=(a,r)=>A.post(`/losses/${a}`,r);function Ce(){const[a,r]=t.useState([]),[p,u]=t.useState(null),[h,x]=t.useState(!1),g=t.useCallback(()=>{x(!0),je().then(l=>{r(l.data.data)}).catch(l=>{u(l)}).finally(()=>{x(!1)})},[]);return{investments:a,setInvestments:r,setError:u,error:p,loading:h,getInvestments:g,addInvestments:async(l,f,d)=>{be(l,{description:f,price:d}).then(n=>{if(!a){r(n.data.data);return}r([...a,n.data.data])}).catch(n=>{console.log(n),u(["Error al crear la sede."])})}}}const Se=({isOpen:a,onClose:r,addInvestment:p})=>{const[u,h]=t.useState(!1),[x,g]=t.useState([]),[_,l]=t.useState("");t.useEffect(()=>{pe().then(n=>{g(n.data.data)})},[]);const f=n=>{l(n.target.value)},d=n=>{h(!0),n.preventDefault();const i=Object.fromEntries(new FormData(n.currentTarget)),w=i.description,m=parseInt(i.price);if(!w||!m){T.error("Debe introducir todos los datos del formulario.");return}p(_,w,m).then().finally(()=>{h(!1)}),r()};return e.jsx(e.Fragment,{children:e.jsx(J,{backdrop:"opaque",isOpen:a,onClose:r,size:"lg",children:e.jsx(K,{children:n=>e.jsxs(e.Fragment,{children:[e.jsxs(Q,{className:"flex items-end  space-x-2 gap-1 font-[sans-serif] ",children:[e.jsx("img",{src:"./logo.webp",alt:"Logo reycel",className:"w-10 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Agregar Inversion o Merma"})]}),e.jsx(W,{children:e.jsxs(X,{onSubmit:d,children:[e.jsx("div",{className:"flex flex-col gap-4 min-w-full items-center",children:e.jsx(Y,{isRequired:!0,className:"w-full",label:"Sede",name:"sede",placeholder:"Seleccione la Sede",labelPlacement:"outside",onChange:f,children:x&&x.map(i=>e.jsx(Z,{children:i.direction},i.id))})}),e.jsx("div",{className:"flex gap-2 min-w-full",children:e.jsx(q,{name:"price",autoFocus:!0,startContent:e.jsx("span",{className:"text-sm text-default-800 pointer-events-none flex-shrink-0",children:"$"}),label:"Precio",placeholder:"Ingrese el precio de la inversion o merma",variant:"bordered",labelPlacement:"outside"})}),e.jsx(he,{label:"Descripcion:",name:"description",isRequired:!0,labelPlacement:"outside",placeholder:"Introduce la descripcion de la inversion o merma."}),e.jsxs("div",{className:"flex min-w-full justify-end mt-5 gap-3",children:[e.jsx(C,{color:"danger",variant:"light",onPress:n,children:"Cancelar"}),e.jsxs(C,{color:"primary",type:"submit",children:[u&&e.jsx(O,{color:"danger"}),!u&&e.jsx("span",{children:"Guardar"})]})]})]})})]})})})})};function ve(a){return a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():""}const P=[{name:"SEDE",uid:"image",sortable:!0},{name:"DESCRIPCION",uid:"description",sortable:!0},{name:"IMPORTE",uid:"price"}],_e=["image","description","price"];function Ee(){const{investments:a,error:r,getInvestments:p,addInvestments:u,loading:h}=Ce(),{isOpen:x,onOpen:g,onClose:_}=ee(),[l,f]=t.useState(""),[d,n]=t.useState(new Set(_e)),[i,w]=t.useState(10),[m,V]=t.useState({column:"name",direction:"ascending"}),[c,j]=t.useState(1),y=!!l,E=t.useCallback(()=>{g()},[g]);t.useEffect(()=>{p()},[p]);const B=t.useMemo(()=>d==="all"?P:P.filter(s=>Array.from(d).includes(s.uid)),[d]),N=t.useMemo(()=>{if(!a)return[];let s=[...a];return y&&(s=s.filter(o=>o.description.toLowerCase().includes(l.toLowerCase())||o.price.toString().toLowerCase().includes(l.toLowerCase()))),s},[l,y,a]),b=Math.ceil(N.length/i),D=t.useMemo(()=>{const s=(c-1)*i,o=s+i;return N.slice(s,o)},[c,N,i]),U=t.useMemo(()=>[...D].sort((s,o)=>{const I=s[m.column],S=o[m.column],v=I<S?-1:I>S?1:0;return m.direction==="descending"?-v:v}),[m,D]),$=t.useCallback((s,o)=>{var S,v,z;const I=s[o];switch(o){case"image":return e.jsx(ge,{avatarProps:{radius:"lg",src:(S=s.Sede)==null?void 0:S.image},name:(v=s.Sede)==null?void 0:v.direction,description:(z=s.Sede)==null?void 0:z.phone});case"description":return e.jsx("div",{className:"flex flex-col",children:e.jsx("p",{className:"text-bold text-small capitalize",children:s.description})});case"price":return e.jsx("div",{className:"flex flex-col",children:e.jsxs("p",{className:"text-bold text-small capitalize",children:["$",s.price]})});default:return String(I)}},[]),L=t.useCallback(()=>{c<b&&j(c+1)},[c,b]),M=t.useCallback(()=>{c>1&&j(c-1)},[c]),k=t.useCallback(s=>{w(Number(s.target.value)),j(1)},[]),F=t.useCallback(s=>{s?(f(s),j(1)):f("")},[]),R=t.useCallback(()=>{f(""),j(1)},[]),G=t.useMemo(()=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex justify-between gap-3 items-end",children:[e.jsx(q,{isClearable:!0,className:"w-full sm:max-w-[44%]",placeholder:"Búsqueda por nombre...",startContent:e.jsx(se,{}),value:l,onClear:()=>R(),onValueChange:F}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(te,{children:[e.jsx(ae,{className:"hidden sm:flex",children:e.jsx(C,{endContent:e.jsx(ne,{className:"text-small"}),variant:"flat",children:"Columnas"})}),e.jsx(le,{disallowEmptySelection:!0,"aria-label":"Table Columns",closeOnSelect:!1,selectedKeys:d,selectionMode:"multiple",onSelectionChange:n,children:P.map(s=>e.jsx(re,{className:"capitalize",children:ve(s.name)},s.uid))})]}),e.jsx(C,{color:"success",endContent:e.jsx(oe,{}),onPress:E,children:"Nueva Investments"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-default-400 text-small",children:["Total ",a==null?void 0:a.length," investments"]}),e.jsxs("label",{className:"flex items-center text-default-400 text-small",children:["Filas por páginas:",e.jsxs("select",{className:"bg-transparent outline-none text-default-400 text-small",onChange:k,children:[e.jsx("option",{value:"10",children:"10"}),e.jsx("option",{value:"15",children:"15"}),e.jsx("option",{value:"20",children:"20"})]})]})]})]}),[l,F,d,E,a==null?void 0:a.length,k,R]),H=t.useMemo(()=>e.jsxs("div",{className:"py-2 px-2 flex justify-between items-center",children:[e.jsx(ie,{isCompact:!0,showControls:!0,showShadow:!0,color:"success",page:c,total:b,onChange:j}),e.jsxs("div",{className:"hidden sm:flex w-[30%] justify-end gap-2",children:[e.jsx(C,{isDisabled:b===1,size:"md",variant:"flat",onPress:M,color:"danger",children:"Anterior"}),e.jsx(C,{isDisabled:b===1,size:"md",variant:"flat",onPress:L,color:"success",children:"Siguiente"})]})]}),[c,b,M,L]);return e.jsxs(e.Fragment,{children:[r&&T.error(r),e.jsxs(ce,{isHeaderSticky:!0,"aria-label":"Example table with custom cells, pagination and sorting",bottomContent:H,bottomContentPlacement:"outside",classNames:{wrapper:"max-h-[600px]"},sortDescriptor:m,topContent:G,topContentPlacement:"outside",onSortChange:V,children:[e.jsx(de,{columns:B,children:s=>e.jsx(ue,{align:s.uid==="actions"?"center":"start",allowsSorting:s.sortable,children:s.name},s.uid)}),e.jsx(me,{isLoading:h,loadingContent:e.jsx(O,{color:"success"}),emptyContent:"No investments found",items:U,children:s=>e.jsx(xe,{children:o=>e.jsx(fe,{children:$(s,o)})},s.id)})]}),e.jsx(Se,{isOpen:x,onClose:_,addInvestment:u})]})}export{ve as Capitalize,Ee as default};
